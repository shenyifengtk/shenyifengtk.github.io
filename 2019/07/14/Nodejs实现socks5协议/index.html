<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.ico?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.ico?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="作为程序员大家都接触过ss、ssr、v2ray这些工具吧，这些工具与客户端通信基本都是用socks5协议，有必要深入了解一下  #socks5 介绍 socks5s是一种网络传输协议，主要用于客户端与外网服务器之间通讯的中间传递。当防火墙后的客户端要访问外部的服务器时，就跟SOCKS代理服务器连接。这个代理服务器控制客户端访问外网的资格，允许的话，就将客户端的请求发往外部的服务器。  根据OSI">
<meta name="keywords" content="socks5">
<meta property="og:type" content="article">
<meta property="og:title" content="使用nodejs实现socks5协议">
<meta property="og:url" content="https://shenyifengtk.github.io/2019/07/14/Nodejs实现socks5协议/index.html">
<meta property="og:site_name" content="神易风 blog">
<meta property="og:description" content="作为程序员大家都接触过ss、ssr、v2ray这些工具吧，这些工具与客户端通信基本都是用socks5协议，有必要深入了解一下  #socks5 介绍 socks5s是一种网络传输协议，主要用于客户端与外网服务器之间通讯的中间传递。当防火墙后的客户端要访问外部的服务器时，就跟SOCKS代理服务器连接。这个代理服务器控制客户端访问外网的资格，允许的话，就将客户端的请求发往外部的服务器。  根据OSI">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://s2.ax1x.com/2019/06/27/Zu2Zpn.png">
<meta property="og:updated_time" content="2019-07-15T14:43:39.123Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用nodejs实现socks5协议">
<meta name="twitter:description" content="作为程序员大家都接触过ss、ssr、v2ray这些工具吧，这些工具与客户端通信基本都是用socks5协议，有必要深入了解一下  #socks5 介绍 socks5s是一种网络传输协议，主要用于客户端与外网服务器之间通讯的中间传递。当防火墙后的客户端要访问外部的服务器时，就跟SOCKS代理服务器连接。这个代理服务器控制客户端访问外网的资格，允许的话，就将客户端的请求发往外部的服务器。  根据OSI">
<meta name="twitter:image" content="https://s2.ax1x.com/2019/06/27/Zu2Zpn.png">





  
  
  <link rel="canonical" href="https://shenyifengtk.github.io/2019/07/14/Nodejs实现socks5协议/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>使用nodejs实现socks5协议 | 神易风 blog</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111663733-2"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !false) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-111663733-2');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">神易风 blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">求知若饥，虚心若愚</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenyifengtk.github.io/2019/07/14/Nodejs实现socks5协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="神易峰">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="神易风 blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">使用nodejs实现socks5协议

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-14 15:49:00" itemprop="dateCreated datePublished" datetime="2019-07-14T15:49:00+08:00">2019-07-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-15 22:43:39" itemprop="dateModified" datetime="2019-07-15T22:43:39+08:00">2019-07-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/NodeJs/" itemprop="url" rel="index"><span itemprop="name">NodeJs</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/14/Nodejs实现socks5协议/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/14/Nodejs实现socks5协议/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">7.7k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">7 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>作为程序员大家都接触过ss、ssr、v2ray这些工具吧，这些工具与客户端通信基本都是用socks5协议，有必要深入了解一下</p>
</blockquote>
<p>#socks5 介绍</p>
<p>socks5s是一种网络传输协议，主要用于客户端与外网服务器之间通讯的中间传递。当防火墙后的客户端要访问外部的服务器时，就跟SOCKS代理服务器连接。这个代理服务器控制客户端访问外网的资格，允许的话，就将客户端的请求发往外部的服务器。 <img src="https://s2.ax1x.com/2019/06/27/Zu2Zpn.png" alt="参考图"><br> 根据OSI模型，SOCKS是会话层的协议，位于表示层与传输层之间，也就是说socks是在TCP 之上的协议。</p>
<h3 id="和HTTP代理相比"><a href="#和HTTP代理相比" class="headerlink" title="和HTTP代理相比"></a>和HTTP代理相比</h3><p>HTTP代理只能代理http请求，像TCP、HTTPS这些协议显得很无力，有一定的局限性。<br>SOCKS工作在比HTTP代理更低的层次：SOCKS使用握手协议来通知代理软件其客户端试图进行的连接SOCKS，然后尽可能透明地进行操作，而常规代理可能会解释和&gt;重写报头（例如，使用另一种底层协议，例如FTP；然而，HTTP代理只是将HTTP请求转发到所需的HTTP服务器）。虽然HTTP代理有不同的使用模式，CONNECT方法允<br>许转发TCP连接；然而，SOCKS代理还可以转发UDP流量和反向代理，而HTTP代理不能。HTTP代理通常更了解HTTP协议，执行更高层次的过滤（虽然通常只用于GET和<br>POST方法，而不用于CONNECT方法）。</p>
<p>#SOCKS协议内容</p>
<blockquote>
<p><a href="https://www.ietf.org/rfc/rfc1928.txt" target="_blank" rel="noopener">官方协议RFC</a></p>
</blockquote>
<h3 id="选择认证方法"><a href="#选择认证方法" class="headerlink" title="选择认证方法"></a>选择认证方法</h3><p> 大体说下socks连接过程，首先客户端发送一个数据包到socks代理</p>
<table>
<thead>
<tr>
<th align="center">Var</th>
<th align="center">NMETHODS</th>
<th align="center">METHODS</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0-255</td>
</tr>
</tbody></table>
<p>表格里面的单位表示位数</p>
<ul>
<li><strong>Var</strong> 表示是SOCK版本，应该是５;</li>
<li><strong>NMETHODS</strong> 表示 <strong>METHODS</strong>部分的长度</li>
<li><strong>METHODS</strong> 表示支持客户端支持的认证方式列表，每个方法占1字节。当前的定义是<ul>
<li>0x00 不需要认证</li>
<li>0x01 GSSAPI</li>
<li>0x02 用户名、密码认证</li>
<li>0x03 - 0x7F由IANA分配（保留）</li>
<li>0x80 - 0xFE为私人方法保留</li>
<li>0xFF 无可接受的方法</li>
</ul>
</li>
</ul>
<p>服务器会响应给客户端</p>
<table>
<thead>
<tr>
<th align="center">VER</th>
<th align="center">METHOD</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody></table>
<ul>
<li><strong>Var</strong> 表示是SOCK版本，应该是５;</li>
<li><strong>METHOD</strong>是服务端选中方法，这个的值为上面<strong>METHODS</strong> 列表中一个。如果客户端支持0x00，0x01，0x02，这三个方法。服务器只会选中一个认证方法返回给客户端，如果返回0xFF表示没有一个认证方法被选中，客户端需要关闭连接。<br>我们先用一个简单Nodejs在实现sock连接握手.查看客户端发送数据报<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"><span class="keyword">let</span> server = net.createServer(<span class="function"><span class="params">sock</span> =&gt;</span>&#123;</span><br><span class="line">sock.once(<span class="string">'data'</span>, (data)=&gt;&#123;</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8888</span>,<span class="string">'localhost'</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>使用curl工具连接nodejs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -x socks5://localhost:8888 https://www.baidu.com</span><br></pre></td></tr></table></figure>

<p>console输出</p>
<blockquote>
<p>&lt;Buffer 05 02 00 01&gt;</p>
</blockquote>
<h3 id="使用账号密码认证"><a href="#使用账号密码认证" class="headerlink" title="使用账号密码认证"></a>使用账号密码认证</h3><p>当服务器选择0x02 账号密码方式认证后，客户端开始发送账号 、密码，数据包格式如下: (以字节为单位)</p>
<table>
<thead>
<tr>
<th align="center">VER</th>
<th align="center">ULEN</th>
<th align="center">UNAME</th>
<th align="center">PLEN</th>
<th align="center">PASSWD</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1 to 255</td>
<td align="center">1</td>
<td align="center">1 to 255</td>
</tr>
</tbody></table>
<ul>
<li>VER是SOCKS版本</li>
<li>ULEN 用户名长度</li>
<li>UNAME   账号string </li>
<li>PLEN 密码长度</li>
<li>PASSWD 密码string</li>
</ul>
<p>可以看出账号密码都是<strong>明文传输</strong>，非常地不安全。<br>服务器端校验完成后，会响应以下数据():</p>
<table>
<thead>
<tr>
<th align="center">VER</th>
<th align="center">STATUS</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">- STATUS  0x00 表示成功，0x01 表示失败</td>
<td align="center"></td>
</tr>
</tbody></table>
<h3 id="封装请求"><a href="#封装请求" class="headerlink" title="封装请求"></a>封装请求</h3><p>认证结束后客户端就可以发送请求信息。客户端开始封装请求信息<br>SOCKS5请求格式（以字节为单位）： </p>
<table>
<thead>
<tr>
<th align="center">VER</th>
<th align="center">CMD</th>
<th align="center">RSV</th>
<th align="center">ATYP</th>
<th align="center">DST.ADDR</th>
<th align="center">DST.PORT</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0x00</td>
<td align="center">1</td>
<td align="center">动态</td>
<td align="center">2</td>
</tr>
</tbody></table>
<ul>
<li><p>VER是SOCKS版本，这里应该是0x05；</p>
</li>
<li><p>CMD是SOCK的命令码</p>
<ul>
<li><p>0x01表示CONNECT请求 </p>
<ul>
<li>CONNECT请求可以开启一个客户端与所请求资源之间的双向沟通的通道。它可以用来创建隧道（tunnel）。例如，*<em><code>CONNECT</code> *</em>可以用来访问采用了 <a href="https://developer.mozilla.org/en-US/docs/Glossary/SSL" title="SSL: SSL (Secure Sockets Layer) is a standard protocol that ensures communication sent between two computer applications is private and secure (cannot be read nor changed by outside observers). It is the foundation for the TLS protocol." target="_blank" rel="noopener">SSL</a> (<a href="https://developer.mozilla.org/en-US/docs/Glossary/HTTPS" title="HTTPS: HTTPS (HTTP Secure) is an encrypted version of the HTTP protocol. It usually uses SSL or TLS to encrypt all communication between a client and a server. This secure connection allows clients to safely exchange sensitive data with a server, for example for banking activities or online shopping." target="_blank" rel="noopener">HTTPS</a>)  协议的站点。客户端要求代理服务器将 TCP 连接作为通往目的主机隧道。之后该服务器会代替客户端与目的主机建立连接。连接建立好之后，代理服务器会面向客户端发送或接收 TCP 消息流。</li>
</ul>
</li>
<li><p>0x02表示BIND请求</p>
<blockquote>
<p>Bind方法使用于目标主机需要主动连接客户机的情况(ftp协议)</p>
</blockquote>
<p>当服务端接收到的数据包中CMD为X’02’时，服务器使用Bind方法进行代理。使用Bind方法代理时服务端需要回复客户端至多两次数据包。</p>
<p>服务端使用TCP协议连接对应的(DST.ADDR, DST.PORT)，如果失败则返回失败状态的数据包并且关闭此次会话。如果成功，则监听(BND.ADDR, BND.PORT)来接受请求的主机的请求，然后返回第一次数据包，该数据包用以让客户机发送指定目标主机连接客户机地址和端口的数据包。</p>
<p>在目标主机连接服务端指定的地址和端口成功或失败之后，回复第二次数据包。此时的(BND.ADDR, BND.PORT)应该为目标主机与服务端建立的连接的地址和端口。</p>
</li>
<li><p>0x03表示UDP转发</p>
</li>
</ul>
</li>
<li><p>RSV 0x00，保留</p>
</li>
<li><p>ATYP 类型</p>
<ul>
<li>0x01 IPv4地址，DST.ADDR部分4字节长度</li>
<li>0x03 域名，DST.ADDR部分第一个字节为域名长度，DST.ADDR剩余的内容为域名，没有\0结尾。</li>
<li>0x04 IPv6地址，16个字节长度。</li>
</ul>
</li>
<li><p>DST.ADDR 目的地址</p>
</li>
<li><p>DST.PORT 网络字节序表示的目的端口<br>示例数据</p>
<blockquote>
<p>&lt;Buffer 05 01 00 01 0e d7 b1 26 01 bb&gt;</p>
</blockquote>
</li>
</ul>
<p>服务器根据客户端封装数据，请求远端服务器，将下面固定格式响应给客户端。</p>
<table>
<thead>
<tr>
<th align="center">VER</th>
<th align="center">REP</th>
<th align="center">RSV</th>
<th align="center">ATYP</th>
<th align="center">BND.ADDR</th>
<th align="center">BND.PORT</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0x00</td>
<td align="center">1</td>
<td align="center">动态</td>
<td align="center">2</td>
</tr>
</tbody></table>
<ul>
<li>VER是SOCKS版本，这里应该是0x05；</li>
<li>REP应答字段<ul>
<li>0x00表示成功</li>
<li>0x01普通SOCKS服务器连接失败</li>
<li>0x02现有规则不允许连接</li>
<li>0x03网络不可达</li>
<li>0x04主机不可达</li>
<li>0x05连接被拒</li>
<li>0x06 TTL超时</li>
<li>0x07不支持的命令</li>
<li>0x08不支持的地址类型</li>
<li>0x09 - 0xFF未定义</li>
</ul>
</li>
<li>RSV 0x00，保留</li>
<li>ATYP<ul>
<li>0x01 IPv4地址，DST.ADDR部分4字节长度</li>
<li>0x03域名，DST.ADDR部分第一个字节为域名长度，DST.ADDR剩余的内容为域名，没有\0结尾。</li>
<li>0x04 IPv6地址，16个字节长度。</li>
</ul>
</li>
<li>BND.ADDR 服务器绑定的地址</li>
<li>BND.PORT 网络字节序表示的服务器绑定的端口</li>
</ul>
<h3 id="使用nodejs-实现CONNECT请求"><a href="#使用nodejs-实现CONNECT请求" class="headerlink" title="使用nodejs　实现CONNECT请求"></a>使用nodejs　实现CONNECT请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"><span class="keyword">const</span> dns = <span class="built_in">require</span>(<span class="string">'dns'</span>);</span><br><span class="line"><span class="keyword">const</span> AUTHMETHODS = &#123; <span class="comment">//只支持这两种方法认证</span></span><br><span class="line">	NOAUTH: <span class="number">0</span>,</span><br><span class="line">	USERPASS: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建socks5监听</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> socket = net.createServer(<span class="function"><span class="params">sock</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//监听错误</span></span><br><span class="line">		sock.on(<span class="string">'error'</span>, (err) =&gt; &#123;</span><br><span class="line">			<span class="built_in">console</span>.error(<span class="string">'error code %s'</span>,err.code);</span><br><span class="line">                        <span class="built_in">console</span>.error(err);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">                sock.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">			sock.destroyed || sock.destroy();</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		sock.once(<span class="string">'data'</span>, autherHandler.bind(sock)); <span class="comment">//处理认证方式</span></span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> autherHandler = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> sock = <span class="keyword">this</span>;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'autherHandler '</span>, data);</span><br><span class="line">	<span class="keyword">const</span> VERSION = <span class="built_in">parseInt</span>(data[<span class="number">0</span>], <span class="number">10</span>);</span><br><span class="line">	<span class="keyword">if</span> (VERSION != <span class="number">5</span>) &#123; <span class="comment">//不支持其他版本socks协议</span></span><br><span class="line">		sock.destoryed || sock.destory();</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">const</span> methodBuf = data.slice(<span class="number">2</span>); <span class="comment">//方法列表</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> methods = [];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; methodBuf.length; i++)</span><br><span class="line">		methods.push(methodBuf[i]);</span><br><span class="line">	<span class="comment">//先判断账号密码方式</span></span><br><span class="line">	<span class="keyword">let</span> kind = methods.find(<span class="function"><span class="params">method</span> =&gt;</span> method === AUTHMETHODS.USERPASS);</span><br><span class="line">	<span class="keyword">if</span> (kind) &#123;</span><br><span class="line">		<span class="keyword">let</span> buf = Buffer.from([VERSION, AUTHMETHODS.USERPASS]);</span><br><span class="line">		sock.write(buf);</span><br><span class="line">		sock.once(<span class="string">'data'</span>, passwdHandler.bind(sock));</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		kind = methods.find(<span class="function"><span class="params">method</span> =&gt;</span> method === AUTHMETHODS.NOAUTH);</span><br><span class="line">		<span class="keyword">if</span> (kind === <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">let</span> buf = Buffer.from([VERSION, AUTHMETHODS.NOAUTH]);</span><br><span class="line">			sock.write(buf);</span><br><span class="line">			sock.once(<span class="string">'data'</span>, requestHandler.bind(sock));</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">let</span> buf = Buffer.from([VERSION, <span class="number">0xff</span>]);</span><br><span class="line">			sock.write(buf);</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 认证账号密码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> passwdHandler = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> sock = <span class="keyword">this</span>;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'data '</span>, data);</span><br><span class="line">	<span class="keyword">let</span> ulen = <span class="built_in">parseInt</span>(data[<span class="number">1</span>], <span class="number">10</span>);</span><br><span class="line">	<span class="keyword">let</span> username = data.slice(<span class="number">2</span>, <span class="number">2</span> + ulen).toString(<span class="string">'utf8'</span>);</span><br><span class="line">	<span class="keyword">let</span> password = data.slice(<span class="number">3</span> + ulen).toString(<span class="string">'utf8'</span>);</span><br><span class="line">	<span class="keyword">if</span> (username === <span class="string">'admin'</span> &amp;&amp; password === <span class="string">'123456'</span>) &#123;</span><br><span class="line">		sock.write(Buffer.from([<span class="number">5</span>, <span class="number">0</span>]));</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		sock.write(Buffer.from([<span class="number">5</span>, <span class="number">1</span>]));</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	sock.once(<span class="string">'data'</span>, requestHandler.bind(sock));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理客户端请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> requestHandler = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> sock = <span class="keyword">this</span>;</span><br><span class="line">	<span class="keyword">const</span> VERSION = data[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">let</span> cmd = data[<span class="number">1</span>]; <span class="comment">// 0x01 先支持 CONNECT连接</span></span><br><span class="line">        <span class="keyword">if</span>(cmd !== <span class="number">1</span>)</span><br><span class="line">          <span class="built_in">console</span>.error(<span class="string">'不支持其他连接 %d'</span>,cmd);</span><br><span class="line">        <span class="keyword">let</span> flag = VERSION === <span class="number">5</span> &amp;&amp; cmd &lt; <span class="number">4</span> &amp;&amp; data[<span class="number">2</span>] === <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (! flag)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">let</span> atyp = data[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">let</span> host,</span><br><span class="line">	port = data.slice(data.length - <span class="number">2</span>).readInt16BE(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">let</span> copyBuf = Buffer.allocUnsafe(data.length);</span><br><span class="line">	data.copy(copyBuf);</span><br><span class="line">	<span class="keyword">if</span> (atyp === <span class="number">1</span>) &#123; <span class="comment">//使用ip 连接</span></span><br><span class="line">		host = hostname(data.slice(<span class="number">4</span>, <span class="number">8</span>));</span><br><span class="line">		<span class="comment">//开始连接主机！</span></span><br><span class="line">	        connect(host, port, copyBuf, sock);</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (atyp === <span class="number">3</span>) &#123; <span class="comment">//使用域名</span></span><br><span class="line">		<span class="keyword">let</span> len = <span class="built_in">parseInt</span>(data[<span class="number">4</span>], <span class="number">10</span>);</span><br><span class="line">		host = data.slice(<span class="number">5</span>, <span class="number">5</span> + len).toString(<span class="string">'utf8'</span>);</span><br><span class="line">		<span class="keyword">if</span> (!domainVerify(host))&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">'domain is fialure %s '</span>, host);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'host %s'</span>, host);</span><br><span class="line">		dns.lookup(host, (err, ip, version) =&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span>(err)&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(err)</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;			</span><br><span class="line">			connect(ip, port, copyBuf, sock);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> connect = <span class="function"><span class="keyword">function</span> (<span class="params">host, port, data, sock</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(port &lt; <span class="number">0</span> || host === <span class="string">'127.0.0.1'</span>)</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'host %s port %d'</span>, host, port);</span><br><span class="line">	<span class="keyword">let</span> socket = <span class="keyword">new</span> net.Socket();</span><br><span class="line">	socket.connect(port, host, () =&gt; &#123;</span><br><span class="line">		data[<span class="number">1</span>] = <span class="number">0x00</span>;</span><br><span class="line">                <span class="keyword">if</span>(sock.writable)&#123;</span><br><span class="line">			sock.write(data);</span><br><span class="line">			sock.pipe(socket);</span><br><span class="line">			socket.pipe(sock);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line"> </span><br><span class="line">        socket.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">		socket.destroyed || socket.destroy();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">	socket.on(<span class="string">'error'</span>, err =&gt; &#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        <span class="built_in">console</span>.error(<span class="string">'connect %s:%d err'</span>,host,port);</span><br><span class="line">			data[<span class="number">1</span>] = <span class="number">0x03</span>;</span><br><span class="line">                        <span class="keyword">if</span>(sock.writable)</span><br><span class="line">			sock.end(data);</span><br><span class="line">			<span class="built_in">console</span>.error(err);</span><br><span class="line">			socket.end();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hostname = <span class="function"><span class="keyword">function</span> (<span class="params">buf</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> hostName = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">if</span> (buf.length === <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; buf.length; i++) &#123;</span><br><span class="line">			hostName += <span class="built_in">parseInt</span>(buf[i], <span class="number">10</span>);</span><br><span class="line">			<span class="keyword">if</span> (i !== <span class="number">3</span>)</span><br><span class="line">				hostName += <span class="string">'.'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (buf.length == <span class="number">16</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">let</span> part = buf.slice(i, i + <span class="number">2</span>).readUInt16BE(<span class="number">0</span>).toString(<span class="number">16</span>);</span><br><span class="line">			hostName += part;</span><br><span class="line">			<span class="keyword">if</span> (i != <span class="number">14</span>)</span><br><span class="line">				hostName += <span class="string">':'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> hostName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验域名是否合法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> domainVerify = <span class="function"><span class="keyword">function</span> (<span class="params">host</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/^([a-zA-Z0-9|\-|_]+\.)?[a-zA-Z0-9|\-|_]+\.[a-zA-Z0-9|\-|_]+(\.[a-zA-Z0-9|\-|_]+)*$/</span>); </span><br><span class="line">	<span class="keyword">return</span> regex.test(host);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">socket.listen(<span class="number">8888</span>,() =&gt; <span class="built_in">console</span>.log(<span class="string">'socks5 proxy running ...'</span>)).on(<span class="string">'error'</span>, err =&gt; <span class="built_in">console</span>.error(err));</span><br></pre></td></tr></table></figure>

<h3 id="end"><a href="#end" class="headerlink" title="end"></a>end</h3><p>和浏览器结合使用的，发现没办法加载斗鱼的视频，不知什么原理，优酷都没有什么问题的．<br>刚刚学习NodeJs一些知识点，写得一般般，有哪里写得不好的，请大家指出来，大家一起讨论。一开始在看协议的时候，以为客户端（浏览器）和服务器在认证请求完后，双方会保持一个TCP长连接，客户端直接发送封装请求数据包．实际上客户端每一个请求都是从认证开始的，每一个请求都是相互独立的，所以<code>once</code>这个方法特别适合这里</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/socks5/" rel="tag"># socks5</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
            
              <div id="needsharebutton-postbottom">
                <span class="btn">
                  <i class="fa fa-share-alt" aria-hidden="true"></i>
                </span>
              </div>
            
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/19/Linux安装Nginx正确方式/" rel="prev" title="Linux安装Nginx正确方式">
                Linux安装Nginx正确方式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpeg" alt="神易峰">
            
              <p class="site-author-name" itemprop="name">神易峰</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#和HTTP代理相比"><span class="nav-number">1.</span> <span class="nav-text">和HTTP代理相比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#选择认证方法"><span class="nav-number">2.</span> <span class="nav-text">选择认证方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用账号密码认证"><span class="nav-number">3.</span> <span class="nav-text">使用账号密码认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装请求"><span class="nav-number">4.</span> <span class="nav-text">封装请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用nodejs-实现CONNECT请求"><span class="nav-number">5.</span> <span class="nav-text">使用nodejs　实现CONNECT请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#end"><span class="nav-number">6.</span> <span class="nav-text">end</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">神易峰</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">274k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">4:09</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.2</div>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/affix.js?v=7.1.2"></script>

  <script src="/js/schemes/pisces.js?v=7.1.2"></script>



  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  
  
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://https-shenyifengtk-github-io.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>


<script>
  var disqus_config = function() {
    this.page.url = "https://shenyifengtk.github.io/2019/07/14/Nodejs实现socks5协议/";
    this.page.identifier = "2019/07/14/Nodejs实现socks5协议/";
    this.page.title = '使用nodejs实现socks5协议';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://https-shenyifengtk-github-io.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    window.addEventListener('load', loadComments, false);
  
</script>





  





  




  

  

  

  

  

  

  

  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>
  <script>
    
      pbOptions = {};
      
        pbOptions.iconStyle = "box";
      
        pbOptions.boxForm = "horizontal";
      
        pbOptions.position = "bottomCenter";
      
        pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook,Linkedin";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
        flOptions.iconStyle = "box";
      
        flOptions.boxForm = "horizontal";
      
        flOptions.position = "middleRight";
      
        flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook,Linkedin";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>


  

  

  

  

  

  

</body>
</html>
